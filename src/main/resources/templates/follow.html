<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<!-- ë°”ê¿€ title ëª…ì„ ë”°ì˜´í‘œì•ˆì— ë„£ëŠ”ë‹¤ -->
<head th:replace="~{fragment/head :: Head ('KoSoo | íŒ”ë¡œìš° ë©¤ë²„')}"><title></title></head>
<style>
    html, body {
        height: 100%;
        background-color: #FFFFF3;
    }

    .feed {
        margin-bottom: 20px;
        border: 1px solid #ccc;
        padding: 10px;
        background-color: #f8f8f8;
    }

    .image img {
        width: 100px;
        height: 100px;
        object-fit: cover;
    }

    .feedContent h4 {
        margin-top: 0;
        color: #333;
    }

    .description p {
        margin: 0;
        color: #666;
    }

    .feedUser span b {
        font-weight: bold;
        color: #555;
    }

    #member-list {
        display: flex; /* ëª©ë¡ì„ ê°€ë¡œë¡œ ë°°ì¹˜í•˜ê¸° ìœ„í•´ flex ì‚¬ìš© */
        column-count: 4; /* ì—´ì˜ ìˆ˜ë¥¼ 4ë¡œ ì„¤ì • */
        flex-wrap: wrap; /* í•„ìš”í•  ê²½ìš° ì—¬ëŸ¬ í–‰ìœ¼ë¡œ ë‚˜ëˆ„ê¸° */
        justify-content: space-around; /* ìš”ì†Œ ì£¼ìœ„ì— ê· ë“±í•œ ê°„ê²© ë°°ì • */
        list-style-type: none; /* ê¸°ë³¸ ëª©ë¡ ë§ˆì»¤ ì œê±° */
    }

    #member-list li {
        width: calc(25% - 1rem); /* 4ì—´ë¡œ ë°°ì¹˜í•˜ë¯€ë¡œ ê° ì•„ì´í…œì˜ ë„ˆë¹„ëŠ” 25% */
        margin-bottom: 1rem; /* ê° ì•„ì´í…œ ê°„ê²© ì„¤ì • */
        box-sizing: border-box; /* ì—¬ë°± í¬í•¨í•œ ë„ˆë¹„ ê³„ì‚° */
        padding: 10px; /* ì•„ì´í…œ ë‚´ë¶€ íŒ¨ë”© ì¶”ê°€ */
        background-color: #f8f8f8; /* ë°°ê²½ìƒ‰ ì¶”ê°€ */
        border: 1px solid #ccc; /* í…Œë‘ë¦¬ ì¶”ê°€ */
    }


    #post-list {
        display: flex; /* ëª©ë¡ì„ ê°€ë¡œë¡œ ë°°ì¹˜í•˜ê¸° ìœ„í•´ flex ì‚¬ìš© */
        flex-wrap: wrap; /* í•„ìš”í•  ê²½ìš° ì—¬ëŸ¬ í–‰ìœ¼ë¡œ ë‚˜ëˆ„ê¸° */
        justify-content: space-around; /* ìš”ì†Œ ì£¼ìœ„ì— ê· ë“±í•œ ê°„ê²© ë°°ì • */
        list-style-type: none; /* ê¸°ë³¸ ëª©ë¡ ë§ˆì»¤ ì œê±° */
        column-count: initial; /* ì—´ì˜ ìˆ˜ ì´ˆê¸°í™” */
    }

    #post-list li {
        width: calc(25% - 1rem); /* 4ì—´ë¡œ ë°°ì¹˜í•˜ë¯€ë¡œ ê° ì•„ì´í…œì˜ ë„ˆë¹„ëŠ” 25% */
        margin-bottom: 1rem; /* ê° ì•„ì´í…œ ê°„ê²© ì„¤ì • */
        box-sizing: border-box; /* ì—¬ë°± í¬í•¨í•œ ë„ˆë¹„ ê³„ì‚° */
        padding: 10px; /* ì•„ì´í…œ ë‚´ë¶€ íŒ¨ë”© ì¶”ê°€ */
        background-color: #D9D9D9; /* ë°°ê²½ìƒ‰ ì¶”ê°€ */
        border: 1px solid #ccc; /* í…Œë‘ë¦¬ ì¶”ê°€ */
    }

    .post {
        /* ë°°ê²½ìƒ‰ ë° ì—¬ë°± ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        background-color: #D9D9D9;
        padding: 10px;
    }

    .feedUser {
        /* ì˜¤ë¥¸ìª½ ì •ë ¬ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        text-align: right;
    }

</style>
<body>
<div class="container-fluid">
    <div th:replace="~{fragment/nav :: Nav}">insert</div>
    <div class="container">
        <div class="container sub-title fs-4 fw-bold">íŒ”ë¡œìš° ì°¾ê¸°</div>
    <ul id="member-list"></ul>
        <div class="container sub-title fs-4 fw-bold">íŒ”ë¡œì‰ ê²Œì‹œê¸€</div>
    <ul id="post-list"></ul>
</div>
</div>
</body>
<script>
    host = "http://localhost:8080"
    $(document).ready(function () {
        const auth = getToken();
        if (auth !== undefined && auth !== '') {
            $.ajaxPrefilter(function (options, originalOptions, jqXHR) {
                jqXHR.setRequestHeader('Authorization', auth);
            });
        }
        loadFeed();
        loadMembers();
    })
    function getToken() {
        let auth = Cookies.get('Authorization');
        if (auth === undefined) {
            return '';
        }

        return auth;
    }
    function loadFeed() {
        // ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        // ìŠ¤í¬ë¡¤ì´ ë§¨ ì•„ë˜ë¡œ ë‚´ë ¤ê°”ì„ ë•Œ ìƒˆë¡œìš´ í”¼ë“œ ì¶”ê°€
        // ìƒˆë¡œìš´ í”¼ë“œ ê°€ì ¸ì˜¤ê¸°
        $.ajax({
            url: 'http://localhost:8080/api/following/posts',
            method: 'GET',
            success: function (response) {
                console.log(response)
                $('#post-list').empty();
                response.forEach(post => {
                    let addHtml = addHTML(post);
                    $('#post-list').append(addHtml)
                });
            },
            error: function (error) {
                console.log('Error:', error);
            }
        });
    }
    function addHTML(post) {
        return `<div class="card customCard">
<div class="post">
                <div class="feedContent">
                    <a class="feedHref" href="http://localhost:8080/api/posts/likes/${post.id}">
                        <h4>${post.title}</h4>
                        <div class="description">
                            <p>${post.content}</p>
                        </div>
                        <a class="feedHref" href="http://localhost:8080/api/posts/likes/${post.id}">
                    <div class="image">
                        <img src="${post.imageUrl}">
                    </div>
                </a>
                        <div> <p><i class="fas fa-heart"></i> ${post.heartNum}</p></div>
                    </a>
                    <div class="subInfo">
                        <span> ${post.modifiedAt} </span>
                        <span class="seperator"></span>
                    </div>
                </div>
                <div class="feedUser">
                    <a class="userInfo" href="">
                        <span>
                            "by "
                            <b>${post.username}</b>
                        </span>
                    </a>
                </div>
                </div>
            </div>
            `
    }
    function loadMembers() {
        // ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        // ìŠ¤í¬ë¡¤ì´ ë§¨ ì•„ë˜ë¡œ ë‚´ë ¤ê°”ì„ ë•Œ ìƒˆë¡œìš´ í”¼ë“œ ì¶”ê°€
        // ìƒˆë¡œìš´ í”¼ë“œ ê°€ì ¸ì˜¤ê¸°
        $.ajax({
            url: 'http://localhost:8080/api/accounts/members',
            method: 'GET',
            success: function (response) {
                console.log(response)
                $('#member-list').empty();
                response.forEach(profile => {
                    let addHtml = addProfile(profile);
                    $('#member-list').append(addHtml)
                });
            },
            error: function (error) {
                console.log('Error:', error);
            }
        });
    }
    function addProfile(profile) {
        return `<div class="post">
                    <div><span>í”„ë¡œí•„</span></div>
                    <div class="image">
                        <img src="${profile.imageUrl}">
                    </div>
                     <div class="feedContent">
                        <h4>${profile.username}</h4>
                        <div class="description">
                            <p>${profile.introduce}</p>
                        </div>
                    </div>
                    <div>
                    <button type="button" class="btn btn-submit" onclick="follow(${profile.id})">íŒ”ë¡œìš°</button>
                    <button type="button" class="btn btn-edit" onclick="unfollow(${profile.id})">ì–¸íŒ”ë¡œìš°</button>
                    </div>
                </div>`
    }
    function follow(id){
        $.ajax({
            type: "POST",
            url: `/api/follows/`+id,
            contentType: "application/json",
        }).done(function () {
            alert("ğŸ˜ íŒ”ë¡œìš° ì„±ê³µ");
            window.location.href = host + "/follows"
        }).fail(function (res) {
            alert(res.responseText);
        })
    }
    function unfollow(id){
        $.ajax({
            type: "DELETE",
            url: `/api/follows/`+id,
            contentType: "application/json",
        }).done(function () {
            alert("ğŸ˜¶ ì–¸íŒ”ë¡œìš° ì„±ê³µ")
            window.location.href = host + "/follows"
        }).fail(function (res) {
            alert(res.responseText);
        })
    }
</script>
</html>